# numu_run1_test.yaml

# Output directory
output_dir: "./output_nue_cc_inclusive_run1_sys/"

# Maximum events to process (set to -1 for all events)
max_events: -1

# Filter out failed events from output tree
filter_events: True

# Enable producer-first mode
producer_first_mode: True

# Print producer dependency graph
print_dependency_graph: true

# Dataset configuration

#-rw-r--r-- 1 twongj01 1030835  35K Jan 15 06:38 lantern_ana.log
#-rw-r----- 1 twongj01 1030835 2.6M Jan 15 06:38 run1_bnb5e19_20260115_063753.root
#-rw-r----- 1 twongj01 1030835 7.4M Jan 15 06:36 run1_bnb_nu_overlay_mcc9_v28_wctagger_20260115_062914.root
#-rw-r----- 1 twongj01 1030835  12M Jan 15 06:29 run1_bnb_nue_overlay_mcc9_v28_wctagger_20260115_061902.root
#-rw-r----- 1 twongj01 1030835 4.6M Jan 15 06:37 run1_extbnb_mcc9_v29e_C1_20260115_063608.root
#-rw-r--r-- 1 twongj01 1030835 2.5K Jan 15 06:38 statistics.yaml

datasets:
  folders:
    - /home/twongjirad/working/data/ntuples/
    - /cluster/tufts/wongjiradlabnu/twongj01/gen2/photon_analysis/lantern_ana/studies/nue_cc_inclusive/output_nue_run1_mmr/
  run1_bnb_nue_overlay_mcc9_v28_wctagger:
    type: RootDataset
    tree: analysis_tree
    ismc: true
    process: true
    filepaths:
     - run1_bnb_nue_overlay_mcc9_v28_wctagger_20260115_061902.root
  run1_bnb_nu_overlay_mcc9_v28_wctagger:
    type: RootDataset
    tree: analysis_tree
    ismc: true
    process: false
    filepaths:
     - run1_bnb_nu_overlay_mcc9_v28_wctagger_20260115_062914.root

# Producer configuration (producers run first)
producers:
  
  xsfluxweight:
    type: ArboristXsecFluxSysProducer
    config:
      output_filename: output_xsecflux_nue_cc_inclusive_run1.root
      run: eventindex_run
      subrun: eventindex_subrun
      event: eventindex_event   
      maxvalidweight: 10.0
      allow_missing_weights: True
      tree: eventweight_tree
      weight_tree_run: run
      weight_tree_subrun: subrun
      weight_tree_event: event
      weight_tree_name: sys_weights
      rootfilepaths:
        run1_bnb_nu_overlay_mcc9_v28_wctagger: /cluster/tufts/wongjiradlabnu/larbys/data/mcc9_eventweight_trees/arborist_v55_Jun20_withExtraGENIE_bnb_nu_run1_noNaNs.root
        run1_bnb_nue_overlay_mcc9_v28_wctagger: /cluster/tufts/wongjiradlabnu/larbys/data/mcc9_eventweight_trees/arborist_v55_Jun20_withExtraGENIE_intrinsic_nue_run1.root
      par_variations_to_include:
        - expskin_FluxUnisim
        - horncurrent_FluxUnisim
        - nucleoninexsec_FluxUnisim
        - nucleonqexsec_FluxUnisim
        - nucleontotxsec_FluxUnisim
        - pioninexsec_FluxUnisim
        - pionqexsec_FluxUnisim
        - piontotxsec_FluxUnisim
        - kminus_PrimaryHadronNormalization
        - kplus_PrimaryHadronFeynmanScaling
        - kzero_PrimaryHadronSanfordWang
        - piminus_PrimaryHadronSWCentralSplineVariation
        - piplus_PrimaryHadronSWCentralSplineVariation
        - All_UBGenie # what is this?
        - XSecShape_CCMEC_UBGenie
        - RPA_CCQE_UBGenie
        - AxFFCCQEshape_UBGenie
        - VecFFCCQEshape_UBGenie
        - DecayAngMEC_UBGenie
        - xsr_scc_Fa3_SCC
        - xsr_scc_Fv3_SCC
        - NormCCCOH_UBGenie
        - NormNCCOH_UBGenie
        - ThetaDelta2NRad_UBGenie
        - Theta_Delta2Npi_UBGenie
        - reinteractions_piminus_Geant4
        - reinteractions_piplus_Geant4
        - reinteractions_proton_Geant4
      cut_formulas:
        pass_vertex: "{ntuple.vertex_properties_found}==1 and {ntuple.vertex_properties_infiducial}==1"
        pass_cosmicfrac: "{ntuple.vertex_properties_cosmicfrac}<1.0"
        pass_nomuon: "{ntuple.recoMuonTrack_nMuTracks}==0"
        pass_electron: "{ntuple.recoElectron_has_primary_electron}==1"
        pass_chargedprimary: "{ntuple.recoElectron_emax_primary_score}>{ntuple.recoElectron_emax_fromcharged_score}"
        pass_neutralprimary: "{ntuple.recoElectron_emax_primary_score}>{ntuple.recoElectron_emax_fromneutral_score}"
        pass_muscore: "{ntuple.recoMuonTrack_max_muscore}<-3.7"
        pass_escore: "{ntuple.recoElectron_emax_econfidence}>7.0"
      event_selection_critera: ['pass_vertex','pass_cosmicfrac','pass_nomuon','pass_electron','pass_chargedprimary','pass_neutralprimary','pass_muscore','pass_escore']
      bin_config: 
        visible_energy:
          formula: visible_energy
          numbins: 15
          minvalue: 0.0
          maxvalue: 3000.0
          # binlist: [0.0,0.2,0.4,0.5,0.6,0.7,0.8,0.9,1.0]
          apply_to_datasets: ['run1_bnb_nu_overlay_mcc9_v28_wctagger','run1_bnb_nue_overlay_mcc9_v28_wctagger']
          criteria: []


# Cut configuration
#cuts: 
#  remove_true_nue_cc:
#    applyto:
#     - run1_bnb_nu_overlay_mcc9_v28_wctagger
#
#cut_logic: "(not {remove_true_nue_cc})"

