# numu_run1_test.yaml

# Output directory
output_dir: "/exp/uboone/app/users/imani/lantern_ana/runs45_zev_mmr/detsys_outputs/"

# Maximum events to process (set to -1 for all events)
max_events: 10

# Filter out failed events from output tree
filter_events: True

# Enable producer-first mode
producer_first_mode: True

# Print producer dependency graph
print_dependency_graph: true

# Dataset configuration
datasets:
  folders:
    - /exp/uboone/app/users/imani/lantern_ana/runs45_zev_mmr/root_outputs/

  # mcc9_v29e_dl_run3b_bnb_nu_overlay_CV:
  #   type: RootDataset
  #   tree: analysis_tree
  #   ismc: true
  #   process: true
  #   filepaths:
  #    - mcc9_v29e_dl_run3b_bnb_nu_overlay_CV_20251007_100019.root

  run4a_v10_04_07_13_BNB_nu_overlay_surprise:
    type: RootDataset
    tree: lantern/EventTree
    pottree: lantern/potTree
    ismc: true
    process: true
    friendtrees:
      weight_tree: xsecweight_MCC9.10_Run4a4c4d5_v10_04_07_13_BNB_nu_overlay_surprise_reco2_hist_4a.root   
    filepaths:
      - MCC9.10_Run4a4c4d5_v10_04_07_13_BNB_nu_overlay_surprise_reco2_hist_4a.root


# Producer configuration (producers run first)
producers:
  detsys_cv100k:
    type: UBDetSysProducer
    config:
      variations_to_include:
        - LYAtt
        - LYDown
        - LYRayleigh
        - wiremodX
        # - wiremodYZ
        # - wiremodThetaXZ
        # - wiremodThetaYZ   
        - 'Recomb2'
        - 'SCE'
        - 'CV'   
      run: eventIndex_run
      subrun: eventIndex_subrun
      event: eventIndex_event
      central_value_dataset: run4a_v10_04_07_13_BNB_nu_overlay_surprise
      variation_rootfiles:
        LYAtt:      /pnfs/uboone/persistent/users/uboonepro/surprise/detvar_test/DetVar_Run45_v10_04_07_15_BNB_nu_overlay_lya_surprise_reco2_hist.root
        LYDown:     /pnfs/uboone/persistent/users/uboonepro/surprise/detvar_test/DetVar_Run45_v10_04_07_15_BNB_nu_overlay_lyd_surprise_reco2_hist.root
        LYRayleigh: /pnfs/uboone/persistent/users/uboonepro/surprise/detvar_test/DetVar_Run45_v10_04_07_15_BNB_nu_overlay_lyr_surprise_reco2_hist.root
        wiremodX:   /pnfs/uboone/persistent/users/uboonepro/surprise/detvar_test/DetVar_Run45_v10_04_07_15_BNB_nu_overlay_WMX_surprise_TEST_reco2_hist.root
        # wiremodYZ:  /home/twongjirad/working/larbys/gen2/container_u20_env/work/lantern_ana/studies/numu_cc_tki/output_tki_run3/run3b_bnb_nu_overlay_wiremodYZ_20251007_100144.root
        # wiremodThetaYZ: /home/twongjirad/working/larbys/gen2/container_u20_env/work/lantern_ana/studies/numu_cc_tki/output_tki_run3/run3b_bnb_nu_overlay_wiremodThetaYZ_20251007_100238.root
        # wiremodThetaXZ: /home/twongjirad/working/larbys/gen2/container_u20_env/work/lantern_ana/studies/numu_cc_tki/output_tki_run3/run3b_bnb_nu_overlay_wiremodThetaXZ_20251007_100212.root
        Recomb2:    /pnfs/uboone/persistent/users/uboonepro/surprise/detvar_test/DetVar_Run45_v10_04_07_15_BNB_nu_overlay_recomb2_surprise_reco2_hist.root
        SCE:        /pnfs/uboone/persistent/users/uboonepro/surprise/detvar_test/DetVar_Run45_v10_04_07_15_BNB_nu_overlay_SCE_surprise_reco2_hist.root
        CV:         /pnfs/uboone/persistent/users/uboonepro/surprise/detvar_test/DetVar_Run45_v10_04_07_15_BNB_nu_overlay_cv_surprise_reco2_hist.root

      variation_treename: analysis_tree
      cut_formulas:
        pass_selection: "{ntuple.numuCC1piNpReco_is_target_1mu1piNproton}==1"
      event_selection_critera: ['pass_selection']
      bin_config: 
        numuCC1piNpReco_delPTT:
          formula: numuCC1piNpReco_delPTT
          numbins: 20
          minvalue: -1.0
          maxvalue: 1.0
          applicable_variations:
           - 'LYAtt'
           - 'LYDown'
           - 'LYRayleigh'
           - 'wiremodX'
          #  - 'wiremodYZ'
          #  - 'wiremodThetaXZ'
          #  - 'wiremodThetaYZ'
            - 'Recomb2'
            - 'SCE'
            - 'CV'
        numuCC1piNpReco_delAlphaT:
          formula: numuCC1piNpReco_delAlphaT
          numbins: 20
          minvalue: 0.0
          maxvalue: 180.0
          applicable_variations:
           - 'LYAtt'
           - 'LYDown'
           - 'LYRayleigh'
           - 'wiremodX'
           - 'wiremodYZ'
           - 'wiremodThetaXZ'
           - 'wiremodThetaYZ'
        numuCC1piNpReco_pN:
          formula: numuCC1piNpReco_pN
          numbins: 17
          minvalue: 0.0
          maxvalue: 1.7
          applicable_variations:
           - 'LYAtt'
           - 'LYDown'
           - 'LYRayleigh'
           - 'wiremodX'
           - 'wiremodYZ'
           - 'wiremodThetaXZ'
           - 'wiremodThetaYZ'
        numuCC1piNpReco_hadronicM:
          formula: numuCC1piNpReco_hadronicM
          numbins: 30
          minvalue: 1000.0
          maxvalue: 1600.0
          applicable_variations:
           - 'LYAtt'
           - 'LYDown'
           - 'LYRayleigh'
           - 'wiremodX'
           - 'wiremodYZ'
           - 'wiremodThetaXZ'
           - 'wiremodThetaYZ'
        numuCC1piNpReco_muKE:
          formula: numuCC1piNpReco_muKE
          binedges: [0.0, 100.0, 200.0, 300.0,400.0,600.0,1500.0]
          applicable_variations:
           - 'LYAtt'
           - 'LYDown'
           - 'LYRayleigh'
           - 'wiremodX'
           - 'wiremodYZ'
           - 'wiremodThetaXZ'
           - 'wiremodThetaYZ'
        numuCC1piNpReco_maxprotonKE:
          formula: numuCC1piNpReco_maxprotonKE
          numbins: 25
          minvalue: 0.0
          maxvalue: 500.0
          applicable_variations:
           - 'LYAtt'
           - 'LYDown'
           - 'LYRayleigh'
           - 'wiremodX'
           - 'wiremodYZ'
           - 'wiremodThetaXZ'
           - 'wiremodThetaYZ'
        numuCC1piNpReco_pionKE:
          formula: numuCC1piNpReco_pionKE
          numbins: 25
          minvalue: 0.0
          maxvalue: 500.0
          applicable_variations:
           - 'LYAtt'
           - 'LYDown'
           - 'LYRayleigh'
           - 'wiremodX'
           - 'wiremodYZ'
           - 'wiremodThetaXZ'
           - 'wiremodThetaYZ'

# Cut configuration
#cuts: 
#  remove_true_nue_cc:
#    applyto:
#     - run1_bnb_nu_overlay_mcc9_v28_wctagger
#
#cut_logic: "(not {remove_true_nue_cc})"
